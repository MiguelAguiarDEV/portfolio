---
import Container from "@/layout/Container.astro";
import { Linkedin, Github, Twitter } from "lucide-astro";
---

<header class="header-layout mt-[1rem] h-[4rem]">
    <div class="layout-constrained w-full h-full flex">
        <Container class="icon !w-fit ml-0 mr-auto h-full p-[0.5rem]">
            <img
                src="/favicon-light.svg"
                alt="Logo"
                class="h-full w-auto opacity-50"
            />
        </Container>
        <Container
            id="nav-dynamic"
            class="pointer-events-auto !h-full !w-fit"
        />
        <Container class="socials !w-fit mr-0 ml-auto flex gap-4 h-full">
            <a href="" class="h-full flex items-center aspect-square">
                <Linkedin class="h-full w-auto" />
            </a>
            <a href="" class="h-full flex items-center aspect-square">
                <Github class="h-full w-auto" />
            </a>
            <a href="" class="h-full flex items-center aspect-square">
                <Twitter class="h-full w-auto" />
            </a>
        </Container>
    </div>
</header>

<script>
    // @ts-nocheck
    const nav = document.getElementById("nav-dynamic");
    const getName = (id) =>
        id
            .replace(/^section-/, "")
            .replace(/-/g, " ")
            .replace(/\b\w/g, (c) => c.toUpperCase());

    function buildButtons() {
        nav.innerHTML = "";
        document.querySelectorAll('[id^="section-"]').forEach((sec) => {
            const btn = document.createElement("button");
            btn.textContent = getName(sec.id);
            btn.onclick = () => window.setActiveSection?.(getName(sec.id));
            nav.appendChild(btn);
        });
        highlightActive();
    }

    function highlightActive() {
        const active = document.querySelector('[id^="section-"].active');
        [...nav.children].forEach((b) => {
            b.classList.toggle(
                "active",
                active && getName(active.id) === b.textContent,
            );
        });
    }

    buildButtons();
    new MutationObserver(buildButtons).observe(
        document.getElementById("app-main") || document.body,
        { childList: true, subtree: true },
    );
    setInterval(highlightActive, 200);
</script>
