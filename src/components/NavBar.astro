---
import Container from "@/layout/Container.astro";
import { Linkedin, Github, Twitter } from "lucide-astro";
---

<header class="header-layout mt-[1rem] h-[4rem]">
    <div class="layout-constrained w-full h-full flex">
        <Container class="icon !w-fit ml-0 mr-auto h-full p-[0.5rem]">
            <img
                src="/favicon-light.svg"
                alt="Logo"
                class="h-full w-auto opacity-50"
            />
        </Container>
        <Container
            id="nav-dynamic"
            role="navigation"
            aria-label="Navegacion principal"
            class="pointer-events-auto !h-full !w-fit relative"
        />
        <Container class="socials !w-fit mr-0 ml-auto flex gap-4 h-full">
            <a href="" class="h-full flex items-center aspect-square">
                <Linkedin class="h-full w-auto" />
            </a>
            <a href="" class="h-full flex items-center aspect-square">
                <Github class="h-full w-auto" />
            </a>
            <a href="" class="h-full flex items-center aspect-square">
                <Twitter class="h-full w-auto" />
            </a>
        </Container>
    </div>
</header>

<script>
    // @ts-nocheck
    const nav = document.getElementById("nav-dynamic");
    const HIGHLIGHT_INSET_X = 9;
    const HIGHLIGHT_INSET_Y = 5;
    const getName = (id) =>
        id
            .replace(/^section-/, "")
            .replace(/-/g, " ")
            .replace(/\b\w/g, (c) => c.toUpperCase());

    function buildButtons() {
        nav.innerHTML = "";
        const highlight = document.createElement("div");
        highlight.id = "nav-highlight";
        highlight.style.position = "absolute";
        highlight.style.height = "0px";
        highlight.style.width = "0px";
        highlight.style.top = "0";
        highlight.style.left = "0";
        highlight.style.background = "rgba(255,255,255,0.2)";
        highlight.style.opacity = "1";
        highlight.style.borderRadius = "0.45rem";
        highlight.style.transition = "all 500ms cubic-bezier(.7,0,.3,1)";
        highlight.style.pointerEvents = "none";
        highlight.style.zIndex = 0;
        highlight.style.boxShadow = "0 2px 8px 0 rgba(0,0,0,0.08)";
        nav.appendChild(highlight);

        document.querySelectorAll('[id^="section-"]').forEach((sec) => {
            const btn = document.createElement("button");
            const label = getName(sec.id);
            btn.type = "button";
            btn.dataset.section = sec.id;
            btn.textContent = label;
            btn.setAttribute("aria-controls", sec.id);
            btn.style.position = "relative";
            btn.style.zIndex = 1;
            btn.addEventListener("click", () => {
                window.setActiveSection?.(label);
                moveHighlight(btn);
            });
            btn.addEventListener("focus", () => moveHighlight(btn));
            nav.appendChild(btn);
        });
        highlightActive();
        setTimeout(() => {
            const activeBtn = nav.querySelector("button.active");
            if (activeBtn) moveHighlight(activeBtn);
        }, 10);
    }

    function highlightActive() {
        const active = document.querySelector('[id^="section-"].active');
        const activeId = active?.id;
        nav.querySelectorAll("button").forEach((b) => {
            b.classList.toggle("active", activeId === b.dataset.section);
        });
        const highlight = nav.querySelector("#nav-highlight");
        const activeBtn = nav.querySelector("button.active");
        if (highlight && activeBtn) moveHighlight(activeBtn);
    }

    function moveHighlight(btn) {
        const highlight = nav.querySelector("#nav-highlight");
        if (!highlight || !btn) return;
        const { offsetLeft, offsetTop, offsetWidth, offsetHeight } = btn;
        const width = Math.max(offsetWidth - HIGHLIGHT_INSET_X * 2, 0);
        const height = Math.max(offsetHeight - HIGHLIGHT_INSET_Y * 2, 0);
        highlight.style.left = `${offsetLeft + HIGHLIGHT_INSET_X}px`;
        highlight.style.top = `${offsetTop + HIGHLIGHT_INSET_Y}px`;
        highlight.style.width = `${width}px`;
        highlight.style.height = `${height}px`;
    }

    buildButtons();
    new MutationObserver(buildButtons).observe(
        document.getElementById("app-main") || document.body,
        { childList: true, subtree: true },
    );
    setInterval(highlightActive, 200);
    window.addEventListener("resize", () => {
        const activeBtn = nav.querySelector("button.active");
        if (activeBtn) moveHighlight(activeBtn);
    });
    nav.addEventListener("scroll", () => {
        const activeBtn = nav.querySelector("button.active");
        if (activeBtn) moveHighlight(activeBtn);
    });
</script>

<style></style>






