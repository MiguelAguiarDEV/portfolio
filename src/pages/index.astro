---
import "@/styles/global.css";
import Section from "@/layout/Section.astro";
import FormContainer from "@/components/FormContainer.astro";
import NavBar from "@/components/NavBar.astro";
import About from "@/components/sections/About.astro";
---

<!doctype html>
<html lang="es" class="dark">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <link
            rel="icon"
            href="/favicon-dark.svg"
            media="(prefers-color-scheme: light)"
        />
        <link
            rel="icon"
            href="/favicon-light.svg"
            media="(prefers-color-scheme: dark)"
        />
        <title>Wipe con navbar</title>
    </head>

    <body class="bg-[#111111] m-0 overflow-hidden text-white">
        <FormContainer />
        <NavBar />
        <main id="app-main" class="h-[100dvh] w-screen box-border relative">
            <About />

            <Section sectionName="Projects" bgColor="#4D179A">PROJECTS</Section>
            <Section sectionName="Skills" bgColor="#892D21">SKILLS</Section>
            <Section sectionName="Experience" bgColor="#BE4387"
                >EXPERIENCE</Section
            >
            <Section sectionName="Contact" bgColor="#306504">CONTACT</Section>
        </main>

        <script>
            // @ts-nocheck
            const toId = (name) =>
                `section-${name
                    .toString()
                    .trim()
                    .toLowerCase()
                    .replace(/[^a-z0-9\s-_]/g, "")
                    .replace(/\s+/g, "-")}`;

            const byId = (id) => document.getElementById(id);

            const sections = Array.from(
                document.querySelectorAll('[id^="section-"]'),
            );

            function play(sectionEl) {
                if (sectionEl.classList.contains("active")) {
                    return;
                }

                sections.forEach((s) => {
                    if (s.classList.contains("play-wipe" || s !== sectionEl)) {
                        s.classList.remove("play-wipe");
                        s.classList.add("wiped");
                        s.classList.add("last");
                        s.classList.remove("active");
                        play(sectionEl);
                        return;
                    }
                    if (s.classList.contains("last")) {
                        s.classList.remove("last");
                        return;
                    }
                    if (s.classList.contains("active")) {
                        s.classList.remove("active");
                        s.classList.add("last");
                        const zIndex = window
                            .getComputedStyle(s)
                            .getPropertyValue("z-index");
                        return;
                    }
                });

                sectionEl.classList.remove("wiped");
                sectionEl.classList.add("active");
                sectionEl.classList.add("play-wipe");
                sectionEl.addEventListener(
                    "animationend",
                    () => {
                        sectionEl.classList.remove("play-wipe");
                        sectionEl.classList.add("wiped");
                    },
                    { once: true },
                );
            }

            window.setActiveSection = (name) => play(byId(toId(name)));
        </script>
    </body>
</html>
