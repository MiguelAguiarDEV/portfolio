---
import "@/styles/global.css";
import Section from "@/layout/Section.astro";
import FormContainer from "@/components/FormContainer.astro";
import NavBar from "@/components/NavBar.astro";
import About from "@/components/sections/About.astro";
import Experience from "@/components/sections/Experience.astro";
import Projects from "@/components/sections/Projects.astro";
import Skills from "@/components/sections/Skills.astro";
import Contact from "@/components/sections/Contact.astro";
---

<!doctype html>
<html lang="es" class="dark">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <link
            rel="icon"
            href="/favicon-dark.svg"
            media="(prefers-color-scheme: light)"
        />
        <link
            rel="icon"
            href="/favicon-light.svg"
            media="(prefers-color-scheme: dark)"
        />
        <title>Wipe con navbar</title>
    </head>

    <body class="bg-[#111111] m-0 overflow-hidden text-white">
        <FormContainer />
        <NavBar />
        <main id="app-main" class="h-[100dvh] w-screen box-border relative">
            <About />
            <Experience />
            <Projects />
            <Skills />
            <Contact />
        </main>

        <script>
            // @ts-nocheck
            const toId = (name) =>
                `section-${name
                    .toString()
                    .trim()
                    .toLowerCase()
                    .replace(/[^a-z0-9\s-_]/g, "")
                    .replace(/\s+/g, "-")}`;

            const byId = (id) => document.getElementById(id);

            const sections = Array.from(
                document.querySelectorAll('[id^="section-"]'),
            );

            function play(sectionEl) {
                if (!sectionEl) return;
                if (sectionEl.classList.contains("active")) return;

                // Limpiar la clase 'last' de todas las secciones
                sections.forEach((s) => s.classList.remove("last"));

                // Encontrar la sección actualmente activa (si existe)
                const prevActive = sections.find((s) =>
                    s.classList.contains("active"),
                );
                if (prevActive) {
                    prevActive.classList.remove("active");
                    prevActive.classList.add("last");
                }

                // Limpiar animaciones previas y clases de transición
                sections.forEach((s) => {
                    s.classList.remove("play-wipe");
                    s.classList.add("wiped");
                });

                // Activar la nueva sección
                sectionEl.classList.remove("wiped");
                sectionEl.classList.add("active");
                sectionEl.classList.add("play-wipe");
                sectionEl.addEventListener(
                    "animationend",
                    () => {
                        sectionEl.classList.remove("play-wipe");
                        sectionEl.classList.add("wiped");
                    },
                    { once: true },
                );
            }

            window.setActiveSection = (name) => play(byId(toId(name)));
        </script>
    </body>
</html>
